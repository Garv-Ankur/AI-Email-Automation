from email_reader import read_unread_emails
from email_sender import send_reply
from intent_detector import detect_intent

# ğŸ” Toggle this to False when you want real Gmail emails
DEMO_MODE = True

def main():
    print("ğŸš€ AI Email Automation Started")

    # ---------------- DEMO MODE ----------------
    if DEMO_MODE:
        print("ğŸ§ª Running in DEMO MODE")
        emails = [{
            "from": "client@example.com",
            "subject": "Follow up on our discussion",
            "body": "Hi, just following up regarding our previous conversation."
        }]
    else:
        emails = read_unread_emails()

    print("ğŸ“¨ Emails fetched:", len(emails))

    for email_data in emails:
        sender = email_data["from"]
        subject = email_data["subject"]
        body = email_data["body"]

        print("\nğŸ“© Email from:", sender)

        intent = detect_intent(body)
        print("ğŸ§  Intent:", intent)

        # âŒ Skip system / no-reply emails
        sender_lower = sender.lower()
        skip_words = [
            "no-reply", "noreply", "do-not-reply",
            "bankbazaar", "microsoft", "newsletter",
            "instagram", "adobe", "start daily"
        ]

        if any(word in sender_lower for word in skip_words):
            print("ğŸš« Skipped system email")
            continue

        # âœ… Send reply only if it's a follow-up
        if intent == "Follow-up":
            send_reply(
                sender,
                "Re: " + subject,
                "Thanks for your follow-up. I will get back to you shortly."
            )
            print("âœ… Auto-reply sent")
        else:
            print("â„¹ï¸ Not a follow-up email")

if __name__ == "__main__":
    main()
